# Writeup 8 - Binaries II

Name: Charlie Schneider
Section: 0101

I pledge on my honor that I have not given or received any unauthorized assistance on this assignment or examination.

Digital acknowledgement: Charles Schneider

## Assignment Writeup

### Part 1 (100 pts)
Answer the following questions regarding the server executable (for which source is provided).

1. How is the per-session administrator password generated? Are there any inherent weaknesses in this implementation? 
The per-session password is generated by first seeding the random number generator with the current time, so the seed is different every time. Then, the server generates 32 random characters between 'A' and 'z' as the password. One inherent weakness is that since the seed is essentially known, the password generation could be replicated by seeding using the same time.

2. Describe two vulnerabilities in this program. Provide specific line numbers and classifications of the vulnerability. Explain potential ramifications as well as ways to avoid these vulnerabilities when writing code. 
First, there is a format string vulnerability on line 46, where `printf` is called on a user-input string. This could allow attackers to dump arbitrary stack values and even alter arbitrary stack values. This vulnerability could be prevented by passing `output` through a format expression, such as `printf(%s, output)`. Another vulnerability is a buffer overflow on line 68. The code uses `gets`, which does no bound checking on the user input, allowing an attacker to overwrite data further down the stack. Since `buff` and `commands` are initialized next to each other, they are close on the stack, so `buff` could be overflowed to overwrite `commands`. This could be prevented by using a more secure function like `fgets`.

3. What is the flag? 
The flag is CMSC389R-{expl017-2-w1n}.

4. Describe the process you followed to obtain the flag: vulnerabilities exploited, your inputs to the server in a human-readable format, etc. If you create any helper code please include it. 
Starting from the end, I knew I had to use `exec_command` to run a command to reveal the flag. To do that, I would need to overwrite the `commands` string to include the right command. To get to `exec_command`, I would somehow need to authenticate and change `admin` to something other than 0. Since `cipher` has a printf vulnerability, so I realized I could try to modify or view certain stack values. I tried to modify `admin` directly with `%n`, but I was not able to find the right location. Instead, I was just able to print `password` directly by choosing option 1 for the cipher and inputting `%24$f`. This gives the password, which I can use to escalte privileges. Then, I can run `exec_command`. I know that `buff` is 33 bytes long, so to write into `commands`, I need to input `cat flag` followed by 25 spaces, then repeat that to overwrite `commands`.
